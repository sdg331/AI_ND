import os
import requests
import base64
from dotenv import load_dotenv

# 1. API 키 가져오기
load_dotenv()
api_key = os.getenv("GEMINI_API_KEY")

print(f"🔑 API 키 확인: {api_key[:5]}...")

# 2. 테스트할 모델: gemini-pro-vision (구형이지만 확실한 놈)
url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro-vision:generateContent?key={api_key}"

# 3. 가짜 이미지 데이터 (하얀 점 1개)
dummy_image = "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII="

# 4. 요청 보내기
headers = {'Content-Type': 'application/json'}
payload = {
    "contents": [{
        "parts": [
            {"text": "이 사진이 뭐야? (테스트입니다)"},
            {"inline_data": {"mime_type": "image/png", "data": dummy_image}}
        ]
    }]
}

print("🚀 구글 서버에 신호를 보내는 중...")

try:
    response = requests.post(url, headers=headers, json=payload)
    result = response.json()

    # 5. 결과 확인
    if "error" in result:
        print("\n❌ 실패! 이 모델도 안 됩니다.")
        print(f"이유: {result['error']['message']}")
    else:
        print("\n✅ 성공! 'gemini-pro-vision' 모델이 살아있습니다!")
        print("응답:", result.get('candidates', [{}])[0].get('content', {}).get('parts', [{}])[0].get('text'))
        print("\n>>> 이제 app.py를 수정해도 안전합니다. <<<")

except Exception as e:
    print(f"\n❌ 통신 오류: {e}")
