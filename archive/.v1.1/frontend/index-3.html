<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FridgeChef</title>
    <style>
        /* --- [ê¸°ë³¸ ìŠ¤íƒ€ì¼] --- */
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; color: #333; margin: 0; padding: 0; padding-bottom: 100px; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        
        h2 { font-size: 1.1rem; color: #495057; margin-top: 30px; margin-bottom: 10px; font-weight: bold; }
        label { font-size: 0.9rem; color: #868e96; display: block; margin-bottom: 5px; font-weight: bold; }
        
        input, button { padding: 12px; width: 100%; box-sizing: border-box; border-radius: 12px; border: 1px solid #ddd; font-size: 1rem; }
        input:focus { outline: none; border-color: #ff6b6b; }
        
        button { background-color: #ff6b6b; color: white; border: none; cursor: pointer; font-weight: bold; margin-top: 5px; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        button.outline { background-color: white; color: #ff6b6b; border: 1px solid #ff6b6b; margin: 0; }

        /* --- [ìˆ˜ì •ë¨] ê°€ë¡œ ìŠ¤í¬ë¡¤ ì„ íƒ ë¸”ë¡ --- */
        .scroll-container {
            display: flex; 
            gap: 10px; 
            overflow-x: auto; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
            padding-bottom: 10px;
            width: 100%;
            flex-wrap: nowrap; /* ì¤„ë°”ê¿ˆ ì ˆëŒ€ ê¸ˆì§€ (ì¼ë ¬ ì •ë ¬) */
            -webkit-overflow-scrolling: touch;
        }

        /* ìŠ¤í¬ë¡¤ë°” ë””ìì¸ (ìˆ¨ê¸°ì§€ ì•Šê³  ì˜ˆì˜ê²Œ í‘œì‹œ) */
        .scroll-container::-webkit-scrollbar { height: 6px; }
        .scroll-container::-webkit-scrollbar-thumb { background: #ddd; border-radius: 10px; }
        .scroll-container::-webkit-scrollbar-track { background: transparent; }

        .select-block {
            min-width: 80px; height: 80px;
            background: white; border: 2px solid #eee; border-radius: 15px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: 0.2s; 
            flex-shrink: 0; /* ê³µê°„ì´ ë¶€ì¡±í•´ë„ ì°Œê·¸ëŸ¬ì§€ì§€ ì•ŠìŒ */
        }
        .select-block.selected {
            border-color: #ff6b6b; background-color: #fff5f5; color: #ff6b6b;
        }
        .block-icon { font-size: 2rem; margin-bottom: 5px; }
        .block-text { font-size: 0.8rem; font-weight: bold; }

        /* íƒ­ë°” ìŠ¤íƒ€ì¼ */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 70px; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; color: #adb5bd; font-size: 0.75rem; padding: 10px; background: none; border: none; cursor: pointer; }
        .nav-item.active { color: #ff6b6b; font-weight: bold; }
        .nav-icon { display: block; font-size: 1.6rem; margin-bottom: 4px; }

        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        #ingredient-list { list-style: none; padding: 0; }
        .ingredient-item { background: white; padding: 15px; margin-bottom: 10px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .file-label { display: block; padding: 20px; background: #e7f5ff; color: #1c7ed6; text-align: center; border-radius: 15px; border: 2px dashed #74c0fc; margin-bottom: 20px; }
        input[type="file"] { display: none; }
        #loading { display: none; text-align: center; margin: 20px 0; }
        .delete-btn { background: #ffc9c9; color: #c92a2a; padding: 8px 12px; width: auto; font-size: 0.8rem; border-radius: 8px; }
    </style>
</head>
<body>

<div style="background: white; padding: 15px 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.03);">
    <div style="display: flex; justify-content: space-between; align-items: center; max-width: 600px; margin: 0 auto;">
        <h1 style="margin: 0; font-size: 1.3rem;">ğŸ¥• FridgeChef</h1>
        <div style="font-size: 0.8rem; color: #888;">
            <input type="text" id="my-user-id" value="user1" style="width: 60px; padding: 5px; text-align: center; display: inline-block;">
            <button onclick="loadData()" style="width: auto; padding: 5px 10px; font-size: 0.7rem;" class="outline">ğŸ”„</button>
        </div>
    </div>
</div>

<div class="container">

    <div id="tab-home" class="tab-content active">
        <h2 style="margin-top: 0;">ğŸ“¸ ì¬ë£Œ ì¶”ê°€</h2>
        <label for="my-img-input" class="file-label">ğŸ“· ì‚¬ì§„ ì°ì–´ ë„£ê¸°</label>
        <input type="file" id="my-img-input" accept="image/*" onchange="uploadImage()">
        
        <div style="display: flex; gap: 8px;">
            <input type="text" id="my-ing-name" placeholder="ì´ë¦„ (ì˜ˆ: ì–‘íŒŒ)" style="flex: 2;">
            <input type="text" id="my-ing-qty" placeholder="ìˆ˜ëŸ‰" style="flex: 1;">
            <button onclick="addIngredient()" style="flex: 1;">ì¶”ê°€</button>
        </div>

        <h2>ğŸ§Š ë‚˜ì˜ ëƒ‰ì¥ê³ </h2>
        <ul id="ingredient-list"></ul>
        <div id="empty-msg" style="text-align: center; color: #adb5bd; margin-top: 20px; display: none;">í…… ë¹„ì—ˆì–´ìš”!</div>
    </div>

    <div id="tab-recipe" class="tab-content">
        <div style="text-align: center; padding: 50px 0;">
            <div style="font-size: 4rem;">ğŸ‘¨â€ğŸ³</div>
            <h3>AI ì…°í”„ì˜ ì¶”ì²œ</h3>
            <button onclick="generateRecipe()" style="width: auto; padding: 15px 30px; border-radius: 30px;">âœ¨ ë ˆì‹œí”¼ ì¶”ì²œë°›ê¸°</button>
        </div>
        <div id="loading">ìš”ë¦¬ ì¤‘...</div>
        <div id="recipe-result" style="display:none; background: white; padding: 20px; border-radius: 15px; margin-top: 20px;">
            <h3 id="res-title" style="color: #ff6b6b;"></h3>
            <p><strong>ğŸ›’ ì¬ë£Œ:</strong> <span id="res-materials"></span></p>
            <div id="res-steps" style="margin-top:15px;"></div>
        </div>
    </div>

    <div id="tab-profile" class="tab-content">
        <h2 style="margin-top: 0;">ğŸ‘¤ ë‚´ ì…ë§› ì„¤ì •</h2>
        <p style="color: #888; font-size: 0.9rem;">AIê°€ ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìš”ë¦¬ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.</p>

        <label>ğŸš« ì•Œë ˆë¥´ê¸° / ëª» ë¨¹ëŠ” ìŒì‹</label>
        <input type="text" id="prof-allergies" placeholder="ì˜ˆ: ë•…ì½©, ìƒˆìš°, ì˜¤ì´">

        <label style="margin-top: 20px;">ğŸ”ª ë³´ìœ  ì¡°ë¦¬ë„êµ¬ (ê°€ë¡œë¡œ ë„˜ê²¨ë³´ì„¸ìš”)</label>
        <div class="scroll-container" id="tools-container">
            </div>

        <label style="margin-top: 20px;">â¤ï¸ ì¢‹ì•„í•˜ëŠ” ì¬ë£Œ</label>
        <input type="text" id="prof-liked" placeholder="ì˜ˆ: ì¹˜ì¦ˆ, ê³ ê¸°, ë§ˆëŠ˜">

        <label style="margin-top: 20px;">ğŸ’” ì‹«ì–´í•˜ëŠ” ì¬ë£Œ</label>
        <input type="text" id="prof-disliked" placeholder="ì˜ˆ: ë‹¹ê·¼, ê³ ìˆ˜">

        <label style="margin-top: 20px;">ğŸ¯ ìš”ë¦¬/ì‹ë‹¨ ëª©í‘œ (ê°€ë¡œë¡œ ë„˜ê²¨ë³´ì„¸ìš”)</label>
        <div class="scroll-container" id="goals-container">
            </div>

        <button onclick="saveProfile()" style="margin-top: 30px; padding: 15px; font-size: 1.1rem;">ì €ì¥í•˜ê¸°</button>
    </div>

</div>

<nav class="bottom-nav">
    <button class="nav-item active" onclick="switchTab('home')"><span class="nav-icon">ğŸ§Š</span>ëƒ‰ì¥ê³ </button>
    <button class="nav-item" onclick="switchTab('recipe')"><span class="nav-icon">ğŸ§‘â€ğŸ³</span>AI ì…°í”„</button>
    <button class="nav-item" onclick="switchTab('profile')"><span class="nav-icon">ğŸ‘¤</span>í”„ë¡œí•„</button>
</nav>

<script>
    const API_URL = "http://127.0.0.1:5000";

    // --- ì„¤ì • ë°ì´í„° ---
    const TOOL_LIST = [
        {icon: "ğŸ³", name: "í”„ë¼ì´íŒ¬"}, {icon: "ğŸ”¥", name: "ê°€ìŠ¤ë ˆì¸ì§€"}, 
        {icon: "ğŸ¥˜", name: "ëƒ„ë¹„"}, {icon: "â™¨ï¸", name: "ì—ì–´í”„ë¼ì´ì–´"},
        {icon: "ğŸ•", name: "ì˜¤ë¸"}, {icon: "âš¡", name: "ì „ìë ˆì¸ì§€"},
        {icon: "ğŸŒªï¸", name: "ë¯¹ì„œê¸°"}, {icon: "ğŸš", name: "ë°¥ì†¥"}
    ];

    const GOAL_LIST = [
        {icon: "ğŸ¥—", name: "ë‹¤ì´ì–´íŠ¸"}, {icon: "ğŸ’ª", name: "ê³ ë‹¨ë°±"}, 
        {icon: "ğŸ§‚", name: "ì €ì—¼ì‹"}, {icon: "ğŸŒ¿", name: "ë¹„ê±´"},
        {icon: "âš¡", name: "ê°„í¸ì‹"}, {icon: "ğŸ±", name: "ë„ì‹œë½"},
        {icon: "ğŸ ", name: "ì§‘ë°¥"}, {icon: "ğŸº", name: "ì•ˆì£¼"}
    ];

    // --- ë¸”ë¡ ìƒì„± í•¨ìˆ˜ ---
    function createBlocks(containerId, list, selectedString) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        const selectedItems = selectedString.split(',').map(s => s.trim());

        list.forEach(item => {
            const div = document.createElement('div');
            div.className = 'select-block';
            if (selectedItems.includes(item.name)) div.classList.add('selected');
            
            div.onclick = () => div.classList.toggle('selected'); 
            
            div.innerHTML = `
                <span class="block-icon">${item.icon}</span>
                <span class="block-text">${item.name}</span>
            `;
            container.appendChild(div);
        });
    }

    function getSelectedValues(containerId) {
        const selected = document.querySelectorAll(`#${containerId} .select-block.selected .block-text`);
        return Array.from(selected).map(el => el.innerText).join(',');
    }

    // --- ë°ì´í„° ë¡œë“œ ---
    async function loadData() {
        const userId = document.getElementById('my-user-id').value;
        
        try {
            const res = await fetch(`${API_URL}/ingredients/${userId}`);
            const list = await res.json();
            const ul = document.getElementById('ingredient-list');
            ul.innerHTML = '';
            if(list.length === 0) document.getElementById('empty-msg').style.display = 'block';
            else {
                document.getElementById('empty-msg').style.display = 'none';
                list.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'ingredient-item';
                    li.innerHTML = `<span>${item.name} <b style="color:#ff6b6b;">${item.quantity}</b></span> <button class="delete-btn" onclick="del('${item.id}')">ì‚­ì œ</button>`;
                    ul.appendChild(li);
                });
            }
        } catch (e) {}

        try {
            const resUser = await fetch(`${API_URL}/users/${userId}`);
            const data = await resUser.json();
            if (!data.error) {
                document.getElementById('prof-allergies').value = data.allergies || '';
                document.getElementById('prof-liked').value = data.liked || '';
                document.getElementById('prof-disliked').value = data.disliked || '';
                
                createBlocks('tools-container', TOOL_LIST, data.tools || '');
                createBlocks('goals-container', GOAL_LIST, data.goals || '');
            }
        } catch (e) {}
    }

    async function saveProfile() {
        const userId = document.getElementById('my-user-id').value;
        const data = {
            allergies: document.getElementById('prof-allergies').value,
            liked: document.getElementById('prof-liked').value,
            disliked: document.getElementById('prof-disliked').value,
            tools: getSelectedValues('tools-container'),
            goals: getSelectedValues('goals-container')
        };

        try {
            await fetch(`${API_URL}/users/${userId}`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data)
            });
            alert("í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        } catch(e) { alert("ì €ì¥ ì‹¤íŒ¨"); }
    }

    function switchTab(name) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + name).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
        if(name=='home') document.querySelectorAll('.nav-item')[0].classList.add('active');
        if(name=='recipe') document.querySelectorAll('.nav-item')[1].classList.add('active');
        if(name=='profile') document.querySelectorAll('.nav-item')[2].classList.add('active');
    }

    async function addIngredient() {
        const userId = document.getElementById('my-user-id').value;
        const name = document.getElementById('my-ing-name').value;
        const qty = document.getElementById('my-ing-qty').value;
        if (!name) return alert("ì´ë¦„ ì…ë ¥!");
        await fetch(`${API_URL}/ingredients/${userId}`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({name, quantity: qty}) });
        document.getElementById('my-ing-name').value = '';
        document.getElementById('my-ing-qty').value = '';
        loadData();
    }
    async function del(id) { if(confirm("ì‚­ì œ?")) { await fetch(`${API_URL}/ingredients/delete/${id}`, {method:'POST'}); loadData(); } }
    
    async function uploadImage() {
        const file = document.getElementById('my-img-input').files[0];
        if(!file) return;
        const formData = new FormData(); formData.append('image', file); formData.append('userId', document.getElementById('my-user-id').value);
        await fetch(`${API_URL}/ingredients/vision`, { method: 'POST', body: formData });
        loadData();
    }

    async function generateRecipe() {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('recipe-result').style.display = 'none';
        try {
            const res = await fetch(`${API_URL}/ai/generate`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({userId: document.getElementById('my-user-id').value}) });
            const json = await res.json();
            document.getElementById('res-title').innerText = json.recipeName;
            document.getElementById('res-materials').innerText = json.materialsUsed;
            document.getElementById('res-steps').innerHTML = json.cookingSteps.map(s => `<p>ğŸ³ ${s}</p>`).join('');
            document.getElementById('recipe-result').style.display = 'block';
        } catch(e) { alert("ì˜¤ë¥˜"); } finally { document.getElementById('loading').style.display = 'none'; }
    }

    window.onload = function() { loadData(); switchTab('home'); };
</script>
</body>
</html>
