<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FridgeChef</title>
    <style>
        /* --- ìŠ¤íƒ€ì¼ --- */
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; color: #333; margin: 0; padding-bottom: 90px; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        
        input, select, button { padding: 12px; margin: 5px 0; width: 100%; box-sizing: border-box; border-radius: 12px; border: 1px solid #ddd; font-size: 1rem; }
        input:focus { outline: none; border-color: #ff6b6b; }
        button { background-color: #ff6b6b; color: white; border: none; cursor: pointer; font-weight: bold; }
        button.secondary { background-color: #868e96; }
        button.outline { background-color: white; color: #ff6b6b; border: 1px solid #ff6b6b; }

        /* ì¹´í…Œê³ ë¦¬ ë±ƒì§€ ì„ íƒ ìŠ¤íƒ€ì¼ */
        .cat-selector { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 10px; }
        .cat-option {
            padding: 8px 15px; border-radius: 20px; border: 1px solid #ddd; background: white; color: #666; cursor: pointer; font-size: 0.9rem; white-space: nowrap;
        }
        .cat-option.selected { background-color: #ff6b6b; color: white; border-color: #ff6b6b; }

        /* ì¹´í…Œê³ ë¦¬ í•„í„° íƒ­ (ëª©ë¡ ìƒë‹¨) */
        .filter-tabs { display: flex; gap: 10px; overflow-x: auto; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px solid #eee; }
        .filter-tab { background: none; border: none; color: #888; font-weight: bold; padding: 8px 5px; cursor: pointer; white-space: nowrap; width: auto; margin: 0; }
        .filter-tab.active { color: #333; border-bottom: 3px solid #ff6b6b; }

        /* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ */
        .ingredient-item { background: white; padding: 15px; margin-bottom: 10px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .cat-tag { font-size: 0.7rem; padding: 3px 8px; border-radius: 10px; background: #eee; color: #666; margin-right: 8px; }
        
        /* í•˜ë‹¨ íƒ­ë°” ë“± ë‚˜ë¨¸ì§€ ìŠ¤íƒ€ì¼ì€ ìœ ì§€ */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 70px; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); z-index: 1000; }
        .nav-item { flex: 1; text-align: center; color: #adb5bd; font-size: 0.75rem; background: none; border: none; padding: 10px; cursor: pointer; }
        .nav-item.active { color: #ff6b6b; font-weight: bold; }
        .nav-icon { display: block; font-size: 1.6rem; margin-bottom: 4px; }
        .tab-content { display: none; } .tab-content.active { display: block; }
        .file-label { display: block; padding: 20px; background: #e7f5ff; color: #1c7ed6; text-align: center; border-radius: 15px; cursor: pointer; border: 2px dashed #74c0fc; margin-bottom: 20px; }
        input[type="file"] { display: none; }
        #loading, #vision-loading { display: none; text-align: center; margin: 20px 0; }
    </style>
</head>
<body>

<div style="background: white; padding: 15px 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.03);">
    <div style="display: flex; justify-content: space-between; align-items: center; max-width: 600px; margin: 0 auto;">
        <h1 style="margin: 0; font-size: 1.3rem;">ğŸ¥• FridgeChef</h1>
        <div style="font-size: 0.8rem; color: #888;">
            <input type="text" id="my-user-id" value="user1" style="width: 60px; padding: 5px; text-align: center; display: inline-block;">
            <button onclick="loadData()" style="width: auto; padding: 5px 10px; font-size: 0.7rem; margin: 0;" class="outline">ğŸ”„</button>
        </div>
    </div>
</div>

<div class="container">

    <div id="tab-home" class="tab-content active">
        <div style="background: white; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #eee;">
            <h3 style="margin: 0 0 10px 0; font-size: 1rem;">â• ì¬ë£Œ ì¶”ê°€</h3>
            
            <div class="cat-selector" id="input-cats">
                <span class="cat-option selected" onclick="selectInputCat(this, 'ê¸°íƒ€')">ê¸°íƒ€</span>
                <span class="cat-option" onclick="selectInputCat(this, 'ìœ¡ë¥˜')">ğŸ¥© ìœ¡ë¥˜</span>
                <span class="cat-option" onclick="selectInputCat(this, 'ì±„ì†Œ')">ğŸ¥¬ ì±„ì†Œ</span>
                <span class="cat-option" onclick="selectInputCat(this, 'ê³¼ì¼')">ğŸ ê³¼ì¼</span>
                <span class="cat-option" onclick="selectInputCat(this, 'ìœ ì œí’ˆ')">ğŸ¥› ìœ ì œí’ˆ</span>
                <span class="cat-option" onclick="selectInputCat(this, 'ê°€ê³µ')">ğŸ¥« ê°€ê³µ</span>
            </div>
            <input type="hidden" id="selected-category" value="ê¸°íƒ€">

            <div style="display: flex; gap: 8px;">
                <input type="text" id="my-ing-name" placeholder="ì´ë¦„ (ì˜ˆ: ê³„ë€)" style="flex: 2;">
                <input type="text" id="my-ing-qty" placeholder="ìˆ˜ëŸ‰" style="flex: 1;">
            </div>
            <button onclick="addIngredient()" style="margin-top: 10px; width: 100%;">ì¶”ê°€í•˜ê¸°</button>
            
            <div style="margin-top: 15px; border-top: 1px dashed #ddd; padding-top: 10px;">
                 <label for="my-img-input" style="font-size: 0.9rem; color: #1c7ed6; cursor: pointer;">ğŸ“¸ ì‚¬ì§„ìœ¼ë¡œ ìë™ ë“±ë¡</label>
                 <input type="file" id="my-img-input" accept="image/*" onchange="uploadImage()">
                 <div id="vision-loading">ğŸ¤– ë¶„ì„ ì¤‘...</div>
            </div>
        </div>

        <div class="filter-tabs">
            <button class="filter-tab active" onclick="filterList('ì „ì²´')">ì „ì²´</button>
            <button class="filter-tab" onclick="filterList('ìœ¡ë¥˜')">ìœ¡ë¥˜</button>
            <button class="filter-tab" onclick="filterList('ì±„ì†Œ')">ì±„ì†Œ</button>
            <button class="filter-tab" onclick="filterList('ê³¼ì¼')">ê³¼ì¼</button>
            <button class="filter-tab" onclick="filterList('ìœ ì œí’ˆ')">ìœ ì œí’ˆ</button>
            <button class="filter-tab" onclick="filterList('ê°€ê³µ')">ê°€ê³µ</button>
            <button class="filter-tab" onclick="filterList('ê¸°íƒ€')">ê¸°íƒ€</button>
        </div>

        <ul id="ingredient-list"></ul>
        <div id="empty-msg" style="text-align: center; color: #adb5bd; margin-top: 20px; display: none;">ëƒ‰ì¥ê³ ê°€ ë¹„ì—ˆì–´ìš”.</div>
    </div>

    <div id="tab-recipe" class="tab-content">
        <div style="text-align: center; padding: 50px 0;">
            <div style="font-size: 4rem; margin-bottom: 15px;">ğŸ‘¨â€ğŸ³</div>
            <h3>AI ì…°í”„ì˜ ì¶”ì²œ</h3>
            <button onclick="generateRecipe()" style="padding: 15px 30px; font-size: 1.1rem; border-radius: 50px; width: auto;">âœ¨ ë ˆì‹œí”¼ ì¶”ì²œë°›ê¸°</button>
        </div>
        <div id="loading">ìš”ë¦¬ ì¤‘...</div>
        <div id="recipe-result" style="display:none; background: white; padding: 20px; border-radius: 15px; margin-top: 20px;">
            <h3 id="res-title" style="color: #ff6b6b;"></h3>
            <p><strong>ğŸ›’ ì¬ë£Œ:</strong> <span id="res-materials"></span></p>
            <div id="res-steps"></div>
            <p id="res-tip" style="background: #fff9db; padding: 10px; border-radius: 8px; margin-top: 15px;"></p>
        </div>
    </div>

    <div id="tab-profile" class="tab-content">
        <h2>ğŸ‘¤ ë‚´ ì…ë§› ì„¤ì •</h2>
        <input type="text" id="my-allergies" placeholder="ì•Œë ˆë¥´ê¸°">
        <input type="text" id="my-tools" placeholder="ì¡°ë¦¬ë„êµ¬">
        <button class="secondary" onclick="saveProfile()" style="margin-top: 20px;">ì €ì¥</button>
    </div>
</div>

<nav class="bottom-nav">
    <button class="nav-item active" onclick="switchTab('home')"><span class="nav-icon">ğŸ§Š</span>ëƒ‰ì¥ê³ </button>
    <button class="nav-item" onclick="switchTab('recipe')"><span class="nav-icon">ğŸ§‘â€ğŸ³</span>AI ì…°í”„</button>
    <button class="nav-item" onclick="switchTab('profile')"><span class="nav-icon">ğŸ‘¤</span>í”„ë¡œí•„</button>
</nav>

<script>
    const API_URL = "http://127.0.0.1:5000";
    let allIngredients = []; // ì „ì²´ ëª©ë¡ ì €ì¥ìš©

    // --- íƒ­ ì „í™˜ ---
    function switchTab(name) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + name).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
        if(name=='home') document.querySelectorAll('.nav-item')[0].classList.add('active');
        if(name=='recipe') document.querySelectorAll('.nav-item')[1].classList.add('active');
        if(name=='profile') document.querySelectorAll('.nav-item')[2].classList.add('active');
    }

    // --- ì¹´í…Œê³ ë¦¬ ì„ íƒ UI ---
    function selectInputCat(el, cat) {
        document.querySelectorAll('.cat-option').forEach(opt => opt.classList.remove('selected'));
        el.classList.add('selected');
        document.getElementById('selected-category').value = cat;
    }

    // --- ëª©ë¡ í•„í„°ë§ ---
    function filterList(category) {
        // íƒ­ ìŠ¤íƒ€ì¼ ë³€ê²½
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');

        const ul = document.getElementById('ingredient-list');
        ul.innerHTML = '';
        
        const filtered = category === 'ì „ì²´' ? allIngredients : allIngredients.filter(i => i.category && i.category.includes(category));

        if(filtered.length === 0) document.getElementById('empty-msg').style.display = 'block';
        else {
            document.getElementById('empty-msg').style.display = 'none';
            filtered.forEach(item => {
                const li = document.createElement('li');
                li.className = 'ingredient-item';
                // ì¹´í…Œê³ ë¦¬ ë±ƒì§€ í‘œì‹œ
                const catBadge = item.category ? `<span class="cat-tag">${item.category}</span>` : '';
                li.innerHTML = `
                    <div style="display:flex; align-items:center;">
                        ${catBadge}
                        <span>${item.name} <b style="color:#ff6b6b;">${item.quantity}</b></span>
                    </div>
                    <button style="background:#ffc9c9; color:#c92a2a; padding:5px 10px; border-radius:8px; font-size:0.8rem;" onclick="del('${item.id}')">ì‚­ì œ</button>
                `;
                ul.appendChild(li);
            });
        }
    }

    async function loadData() {
        const userId = document.getElementById('my-user-id').value;
        try {
            const res = await fetch(`${API_URL}/ingredients/${userId}`);
            allIngredients = await res.json();
            // í˜„ì¬ í™œì„±í™”ëœ í•„í„° íƒ­ì„ ì°¾ì•„ì„œ ê·¸ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            const activeTab = document.querySelector('.filter-tab.active');
            filterList(activeTab ? activeTab.innerText : 'ì „ì²´');
        } catch (e) { console.log("ë¡œë”© ì‹¤íŒ¨"); }
    }

    async function addIngredient() {
        const userId = document.getElementById('my-user-id').value;
        const name = document.getElementById('my-ing-name').value;
        const qty = document.getElementById('my-ing-qty').value;
        const category = document.getElementById('selected-category').value;

        if (!name) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");

        try {
            await fetch(`${API_URL}/ingredients/${userId}`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: name, quantity: qty, category: category })
            });
            document.getElementById('my-ing-name').value = '';
            document.getElementById('my-ing-qty').value = '';
            loadData();
            alert("ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! (ì¤‘ë³µëœ ì¬ë£ŒëŠ” í•©ì³ì§‘ë‹ˆë‹¤)");
        } catch (e) { alert("ì˜¤ë¥˜"); }
    }

    async function del(id) {
        if(!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
        await fetch(`${API_URL}/ingredients/delete/${id}`, { method: 'POST' });
        loadData();
    }
    
    // (ë‚˜ë¨¸ì§€ ì‚¬ì§„ ì—…ë¡œë“œ, ë ˆì‹œí”¼ ìƒì„± í•¨ìˆ˜ë“¤ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤)
    // í¸ì˜ìƒ ìƒëµí–ˆìœ¼ë‚˜, ê¸°ì¡´ ì½”ë“œê°€ ìˆë‹¤ë©´ ê·¸ëŒ€ë¡œ ë‘ì…”ë„ ë©ë‹ˆë‹¤. 
    // ìœ„ addIngredient, loadData, filterListê°€ í•µì‹¬ì…ë‹ˆë‹¤.
    
    async function uploadImage() { /* ...ê¸°ì¡´ ì½”ë“œ ìœ ì§€... */ 
        const file = document.getElementById('my-img-input').files[0];
        if(!file) return;
        document.getElementById('vision-loading').style.display = 'block';
        const formData = new FormData(); formData.append('image', file); formData.append('userId', document.getElementById('my-user-id').value);
        try {
            await fetch(`${API_URL}/ingredients/vision`, { method: 'POST', body: formData });
            loadData();
        } catch(e){ alert("ì—…ë¡œë“œ ì‹¤íŒ¨"); }
        finally { document.getElementById('vision-loading').style.display = 'none'; }
    }

    async function generateRecipe() { /* ...ê¸°ì¡´ ì½”ë“œ ìœ ì§€... */ 
        document.getElementById('loading').style.display = 'block';
        document.getElementById('recipe-result').style.display = 'none';
        try {
            const res = await fetch(`${API_URL}/ai/generate`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({userId: document.getElementById('my-user-id').value}) });
            const json = await res.json();
            if(json.error) alert(json.error);
            else {
                document.getElementById('res-title').innerText = json.recipeName;
                document.getElementById('res-materials').innerText = json.materialsUsed;
                document.getElementById('res-tip').innerText = json.tip;
                const steps = document.getElementById('res-steps'); steps.innerHTML='';
                json.cookingSteps.forEach(s => { const p = document.createElement('p'); p.innerText="ğŸ³ "+s; steps.appendChild(p); });
                document.getElementById('recipe-result').style.display = 'block';
            }
        } catch(e) { alert("ì˜¤ë¥˜"); } finally { document.getElementById('loading').style.display = 'none'; }
    }

    async function saveProfile() { /* ...ê¸°ì¡´ ì½”ë“œ ìœ ì§€... */ }

    window.onload = function() { loadData(); switchTab('home'); };
</script>
</body>
</html>
